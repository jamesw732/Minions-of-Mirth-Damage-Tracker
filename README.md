# Minions of Mirth Reborn DPS Calc
This program records real-time data on the damage dealt by a given player and uses solely the state of the game log file (client\logs\game.txt file). This file is updated once a certain number of lines have been sent to the game window, I believe it's around 10 lines, and upon each game log update, more damage data is collected. This approach is probably the only one that a third-party program will be able to achieve, however there are some limitations and nuances to it that will be important to understand in order to use this program properly.
## How To Use
To use run program, first either clone this whole repo and then run main.py (requires git Python obviously), or just download DamageTracker.exe and run that. The exact location that you extract to isn't important, but if you download the code then obviously it needs to be all in the same directory. If you clone the repo, you can also build the exe yourself using the command: `pyinstaller -F -n DamageTracker --noconsole main.py`.  
Whichever method you choose, once you're in the GUI, you'll have to put some information in the three top left entries:
1. The name(s) of the character or mob which you wish to track the damage of. If multiple names are entered, then they must be separated by a comma and space. Example: `Flake, Soulgazer`  
2. The global path to the relevant game.txt file. Example: C:\Windows\Program Files\MomReborn\client\logs\game.txt.  
3. The third entry labeled "Threshold" establishes a time threshold (in seconds) such that if the time between two hits by the tracked player is greater than that threshold, then the damage tracking resets. This is desirable because long waits between fights immediately make data over that time period uninteresting. If we reset, then there's at least a chance that we get interesting data. By default, this is 10 seconds, and if you wish to completely disable it, simply input a large number.
Once you have configured these three entires and you have settings that you wish to keep, click "Save Settings", this will create a settings.json file which the program will read from now on to create preset settings. You can save multiple presets and change which one you're using whenever you like using the "Presets" dropdown. You can also delete the current preset using the "Delete Preset" button.
Otherwise, "Start" begins a new damage tracking period, and "Stop" stops it. It will be pretty obvious that you started tracking your damage because a "Tracking DPS" indicator will replace the "Not Tracking" one and data cells will start to magically populate. Clicking "Save Data" will write the current contents of those data cells, including the name, to a local file called damagedata.txt. Minimal formatting is done here, just the name and the values of each of the data fields separated by a space.
## Some Notes on Use
- The elapsed time is based off the difference in time between your first tracked hit and your last tracked hit based on the log timestamps. It was a tough choice between this and just using real time, but with the inactivity timer, I think this is better due to the unreliability of log updates. With this, at least the program will usually be correct about your DPS, albeit from a few seconds ago, while with real time, it will never be correct.
- The accuracy of the program is pretty dependent on the rate of lines entering the game window. The more lines per second, the more accurate the game log is to the actual state of the game, and thus the input to the program is more accurate.
- A common problem is that you kill a mob but there are a few lines of damage that didn't go through. In this case if you care enough to get the complete damage data, pop a couple /who's and this should force a game.txt update, and your damage data (even the time) should be completely fine. The inactivity threshold won't be triggered as long as you don't attack anything since it's only triggered for hits by a tracked character/mob.
- I believe the single player log file is the same as the multiplayer log file, so if you're on single player, you should still be able to use this with the same game.txt path that you would on the Reborn server.
- The min hit and avg hit stats are a little bit useless since kicks and archery will certainly skew these values. But still, I figure there's no point in excluding them. It's probably better and more visually appealing than unused space, anyways.
- If you are tracking for more than one character/mob, the inactivity timer is shared across all of them. Say you're tracking yourself and Mittmani, if you stop attacking for 10 seconds but Mittmani is still attacking, then neither data will reset. So, as long as you're tracking *an* active player, *no* data will reset.
## (Potential) Limitations/Bugs
- After some high amount of lines (18,000 or something), game.txt turns into game.txt.1, and any existing game.txt.1 turns into game.txt.2, etc, and game.txt resets to a blank test file. This will only be an issue for damage tracking very rarely, however I did add handling that *I believe* works. I did not test it by capturing a game.txt rollover in the wild, instead I fabricated the rollover behavior, however it's possible that I'm wrong and did not do this perfectly.
- There are some player names that can break this program. I think the only names that will cause it to break completely are those that have "for" in them as a separate word, ie "\_ for \_". It works normally if "for" is in your name but not as a separate word.
- An unavoidable problem is that mobs with the same name all count towards the same damage source in the tracker. A less avoidable, but still existing problem is that mobs whose names are contained exactly in the name of another mob get double counted - once for their self, once for the other mob. For example, if your name is "Skeleton Bro" and you're fighting a "Skeleton", the skeleton's damage will count towards both itself and you. Cases like these seemed sufficiently rare that I didn't feel the need to spend time handling it in the code (and making the code messier than it already is), however this can change if there's any player using this who is at risk of being affected by this bug.
- In any case, if you notice any bugs, whether mentioned here or not, let me know! I'm unlikely to make any more changes barring requested bug fixes, as this program is currently in pretty much the best state I can envision it being in.